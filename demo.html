<div class="demo">
  <button id="install-btn" style="display: none">Add to "Page Capture" Extension Chrome</button>

  <div id="interacive-demo" style="display: none">

    <div id="box1">
      <h3>Title Box 1</h3>
      <img src="./logo.png">
      <p style="color: red;">
        This will be in the page capture...
      </p>
    </div>

    <div id="options">
      <table>
        <tr>
          <th colspan="2">Api Example</th>
        </tr>
        <tr>
          <td>getVersion</td>
          <td><button disabled id="get_version">run</button></td>
        </tr>
        <tr>
          <td>capturePage</td>
          <td><button disabled id="pc_page">run</button></td>
        </tr>
        <tr>
          <td class="api">captureElement</td>
          <td>
            <div class="params">
              elementId: <input type="text" id="elementId" value="#box1"><br>
              <button disabled id="pc_box1">run</button>
            </div>
          </td>
        </tr>
        <tr>
          <td class="api">captureUrl</td>
          <td>
            <div class="params">
              url: <input type="text" id="url" placeholder="http://"><br>
              <button disabled id="pc_url">run</button>
            </div>
          </td>
        </tr>
        <tr>
          <td class="api">captureUrlWithOverlay</td>
          <td>
            <div class="params">
              url: <input type="text" id="url2" placeholder="http://" value=""><br>
              imgUrl: <input type="text" id="overlay_image" placeholder="http://optional.image.url" value=""><br>
              includeOverlay: <input type="checkbox" checked id="include_overlay"><br>
              <button disabled id="pc_url2">run</button>
            </div>
          </td>
        </tr>
        <tr>
          <td class="api">captureSection</td>
          <td>
            <div class="params">
              x: <input type="number" id="section_x" value="10"><br>
              y: <input type="number" id="section_y" value="10"><br>
              width: <input type="number" id="section_w" value="300"><br>
              height: <input type="number" id="section_h" value="250"><br>
              <button disabled id="pc_section">run</button>
            </div>
          </td>
        </tr>
        <tr>
          <td class="api">captureImage</td>
          <td>
            <div class="params">
              url: <input type="text" id="image_url" placeholder="http://"><br>
              <button disabled id="pc_image">run</button>
            </div>
          </td>
        </tr>
      </table>

    </div>

    <br style="clear: both">
    <h4>&#8650; RESULT &#8650;</h4>
    <div id="result"></div>

    <script type="text/javascript">
      var pcQueue = pcQueue || [];
      var result = document.getElementById('result');

      pcQueue.push(function() {

        document.getElementById('get_version').disabled = false;
        document.getElementById('get_version').onclick = function() {
          PageCapture.getVersion(function(v) {
            result.innerHTML = 'version = ' + v;
          });
        };

        document.getElementById('pc_box1').disabled = false;
        document.getElementById('pc_box1').onclick = function() {
          var selector = document.getElementById('#elementId').value.trim();
          PageCapture.captureElement(selector, function(img) {
            result.innerHTML = '<img src="' + img + '">';
          });
        };

        document.getElementById('pc_page').disabled = false;
        document.getElementById('pc_page').onclick = function() {
          PageCapture.capturePage(function(img) {
            result.innerHTML = '<img src="' + img + '">';
          });
        };

        document.getElementById('pc_section').disabled = false;
        document.getElementById('pc_section').onclick = function() {
          var x = document.getElementById('section_x').value.trim();
          var y = document.getElementById('section_y').value.trim();
          var width = document.getElementById('section_w').value.trim();
          var height = document.getElementById('section_h').value.trim();
          PageCapture.captureSection(x, y, width, height, function(img) {
            result.innerHTML = '<img src="' + img + '">';
          });
        };

        document.getElementById('pc_image').disabled = false;
        document.getElementById('pc_image').onclick = function() {
          var url = document.getElementById('image_url').value;
          PageCapture.captureImage(url, 300, 250, function(img) {
            result.innerHTML = '<img src="' + img + '">';
          });
        };

        document.getElementById('pc_url').disabled = false;
        document.getElementById('pc_url').onclick = function() {
          var url = document.getElementById('url').value;
          PageCapture.captureUrl(url, function(img) {
            result.innerHTML = '<img src="' + img + '">';
          });
        };

        document.getElementById('pc_url2').disabled = false;
        document.getElementById('pc_url2').onclick = function() {
          var url = document.getElementById('url2').value;
          var overlay = document.getElementById('overlay_image').value;
          var includeOverlay = document.getElementById('include_overlay').checked;
          PageCapture.captureUrlWithOverlay(url, overlay, includeOverlay, function(data) {
            var overlayInfo = 'Raw Response <pre>' + JSON.stringify(data, null, 2) + '</pre><br>';
            result.innerHTML = overlayInfo + '<img src="' + data.img + '">';
          });
        };

      });

    </script>

  </div>

  <script>
    (function() {
      if (typeof chrome === 'undefined') {
        $('#content .demo').html('<h1>This demo page will only work in chrome.</h1>');
      } else {
        $('#install-btn').on('click', function() {
          chrome.webstore.install('https://chrome.google.com/webstore/detail/jalljeamdfcpcigocpbgfbebdjfmpdof',
            function() {
              console.log("Sucess", arguments);
              location.reload();
            },
            function() {
              console.log("Failure:", arguments);
            });
        });

        $('.demo .api').on('click', function(){
          $('.demo .params').hide();
          $(this).parents('tr').find('.params').show();
        });

        setTimeout(function() {
          if (chrome.app && typeof PageCapture === 'undefined') {
            $('#install-btn').show();
          } else {
            $('#interacive-demo').show();
          }
        }, 500);
      }
    })();
  </script>
</div>